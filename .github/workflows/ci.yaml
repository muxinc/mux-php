name: Integration Test

# Much like mux-go, mux-php is in a spot where "releases" are kind of
# ignored by Packagist and there's that webhook to hit to say "crawl
# me and get a new release". As such we're in the "make sure the barn
# door closes properly" spot unless we want to go manually hit webhooks
# and I think it's probably better to leave well enough alone. However,
# we can at least have it report failures and give us an option for
# manually handling release failures.

on:
  push:
    branches:
      - master
  pull_request: {}
  release:
    types: [created]

jobs:
  build:
    name: Integration Test
    runs-on: ubuntu-latest
    steps:
      - name: Check out code
        uses: actions/checkout@v2
      - name: Install PHP 
        uses: shivammathur/setup-php@v2
        with:
          php-version: '7.3'
      - name: Install PHP Dependencies
        run: composer install
      - name: Run Integration Tests
        env:
          MUX_TOKEN_ID: ${{ secrets.MUX_TOKEN_ID }}
          MUX_TOKEN_SECRET: ${{ secrets.MUX_TOKEN_SECRET }}
        run: bash test.sh
